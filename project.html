<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Explorable Explanation: Themes and Topics in Jane Eyre</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        padding-top: 20px;
        padding-bottom: 20px;
      }
      .container {
        max-width: 1200px;
        margin: auto;
      }
      h1,
      h2,
      h3,
      h4,
      h5 {
        margin-top: 30px;
      }
      .visualization {
        margin-top: 20px;
        margin-bottom: 20px;
      }
      .highlighted-text {
        white-space: pre-wrap;
        border: 1px solid #ddd;
        padding: 10px;
        height: 300px;
        overflow-y: scroll;
        margin-bottom: 20px;
      }
      .slider-container {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>
        Using Topic Models to Explore Themes and Topics in Charlotte Brontë's
        Jane Eyre
      </h1>

      <section id="introduction">
        <h2>Introduction</h2>
        <p>
          Welcome to our interactive exploration of <em>Jane Eyre</em> using
          topic modeling! This page is designed to help you understand how topic
          models can be used to uncover themes and topics in literature. We'll
          walk you through the steps of our analysis, showcasing our findings
          along the way.
        </p>
        <p><strong>Our main goals:</strong></p>
        <ul>
          <li>To infer thematic clusters within the novel.</li>
          <li>
            To analyze how well the topics generated by the LDA model align with
            the content of the chapters.
          </li>
        </ul>
      </section>

      <section id="preprocessing-the-text">
        <h2>Preprocessing the Text</h2>
        <p>
          Before we dive into topic modeling, we need to preprocess the text to
          clean and prepare it for analysis. This involves removing stopwords,
          punctuation, and other non-essential elements, and then tokenizing the
          text into words.
        </p>
        <pre><code>python
# Define the preprocessing function
def preprocess(text):
    stop_words = set(stopwords.words("english"))
    custom_stopwords = {"mrs", "mr", "miss", "said", "sir", "one", "would", "could", "said", "-"}
    stop_words.update(custom_stopwords)

    text = re.sub(r'[^a-zA-Z\s]', '', text, re.I|re.A)
    text = re.sub(r'\n', ' ', text)
    text = re.sub("_", "", text)
    text = text.lower()
    tokens = nltk.word_tokenize(text)
    tokens = [word for word in tokens if not word in stop_words]
    return tokens

# Split the text into chapters
chapters = text.split('CHAPTER ')[1:]

# Tokenize chapters
tokenized_chapters = [preprocess(chapter) for chapter in chapters]
        </code></pre>
      </section>

      <section id="building-the-lda-model">
        <h2>Building the LDA Model</h2>
        <p>
          Once the text is preprocessed, we build the LDA model. This model will
          help us uncover the hidden topics within <em>Jane Eyre</em>.
        </p>
        <pre><code>python
# Create dictionary and corpus
dictionary = Dictionary(tokenized_chapters)
dictionary.filter_extremes(no_below=15, no_above=0.5)
corpus = [dictionary.doc2bow(chapter) for chapter in tokenized_chapters]

# Build the LDA model
optimal_model = LdaModel(corpus=corpus, num_topics=18, id2word=dictionary, passes=50, iterations=100, random_state=43)
        </code></pre>
      </section>

      <section id="visualizing-the-topics">
        <h2>Visualizing the Topics</h2>
        <p>
          We use interactive visualizations to explore the topics identified by
          the LDA model. These visualizations help us understand the
          distribution and prominence of each topic across the chapters.
        </p>
        <div class="visualization">
          <h4>PyLDAvis Visualization</h4>
          <p>Explore the interactive visualization of the topics:</p>
          <a
            href="lda_visualization.html"
            target="_blank"
            class="btn btn-primary"
            >Explore the LDA Visualization</a
          >
        </div>
      </section>

      <section id="top-positive-and-negative-topics">
        <h2>Top Positive and Negative Topics</h2>
        <p>
          We analyze the sentiment scores associated with each topic to identify
          the top positive and negative topics. This helps us understand the
          emotional tone of the themes discovered by the LDA model.
        </p>
        <pre><code>python
# Initialize VADER sentiment analyzer
sia = SentimentIntensityAnalyzer()

# Calculate sentiments for each chapter
chapter_sentiments = [sia.polarity_scores(' '.join(chapter))['compound'] for chapter in tokenized_chapters]

# Calculate average sentiment scores for each topic
topic_sentiments = np.zeros(num_topics)
topic_token_counts = np.zeros(num_topics)
topic_chapter_counts = np.zeros(num_topics)

for i, chapter in enumerate(tokenized_chapters):
    topic_distribution = optimal_model.get_document_topics(corpus[i], minimum_probability=0)
    for topic_id, probability in topic_distribution:
        sentiment = sia.polarity_scores(' '.join(chapter))['compound']
        topic_sentiments[topic_id] += sentiment * probability
        topic_token_counts[topic_id] += len(chapter) * probability
        topic_chapter_counts[topic_id] += probability

# Normalize the sentiment scores
average_topic_sentiments = topic_sentiments / np.where(topic_chapter_counts == 0, 1, topic_chapter_counts)

# Prepare the data for Plotly
data = {
    'Topic': np.arange(num_topics),
    'Average Sentiment Score': average_topic_sentiments,
    'Log Proportion of Tokens': np.log1p(topic_token_counts / topic_token_counts.sum()),
    'Token Proportion': topic_token_counts / topic_token_counts.sum(),
    'Number of Chapters': topic_chapter_counts
}

df = pd.DataFrame(data)

# Filter out topics with zero counts in all metrics
df = df[(df['Number of Chapters'] > 0) | (df['Token Proportion'] > 0) | (df['Average Sentiment Score'] != 0)]

# Define color based on sentiment
def get_color(score):
    if score >= 0.5:
        return 'blue'
    elif score <= -0.5:
        return 'red'
    else:
        return 'lightgrey'

df['Color'] = df['Average Sentiment Score'].apply(get_color)

# Create the interactive scatter plot with hover tooltips using Plotly
fig = px.scatter(
    df,
    x='Average Sentiment Score',
    y='Log Proportion of Tokens',
    color='Color',
    color_discrete_map={'blue': 'blue', 'red': 'red', 'lightgrey': 'lightgrey'},
    size='Number of Chapters',
    hover_data={
        'Topic': True,
        'Average Sentiment Score': ':.2f',
        'Token Proportion': ':.2f',
        'Number of Chapters': True
    },
    title='Sentiment Distribution Across Topics in Jane Eyre'
)

# Show the plot
fig.show()
        </code></pre>
        <div class="visualization">
          <h4>Top Positive Topics</h4>
          <ul>
            <li>Topic 4: Adèle, Mrs. Fairfax, beauty, position</li>
            <li>Topic 6: Thornfield, moon, sir, rain, road</li>
            <li>Topic 10: Ladies, servants, gentleman, Mrs. Fairfax, Adèle</li>
            <li>Topic 15: Fairfax, Thornfield, road, Mrs. Fairfax, calm</li>
            <li>Topic 12: Lowood, Thornfield, ladies, French, liberty</li>
          </ul>
          <h4>Top Negative Topics</h4>
          <ul>
            <li>Topic 1: Die, aid, rain, servant, human</li>
            <li>Topic 11: Wife, human, calm, heaven, suddenly</li>
            <li>Topic 17: Mrs. Fairfax, Thornfield, front, Adèle, chamber</li>
            <li>Topic 8: Children, French, broken, sad, frame</li>
            <li>Topic 0: Sisters, dead, mere, blood, demanded</li>
          </ul>
        </div>
      </section>

      <section id="topic-evolution-over-chapters">
        <h2>Topic Evolution Over Chapters</h2>
        <p>
          We also explore how topics evolve over the course of the novel. This
          visualization helps us see which themes are prominent at different
          points in the story.
        </p>
        <div class="visualization">
          <h4>Topic Evolution</h4>
          <a href="topic_evolution.html" target="_blank" class="btn btn-primary"
            >Explore Topic Evolution</a
          >
        </div>
      </section>

      <section id="chapter-contributions-to-topics">
        <h2>Chapter Contributions to Topics</h2>
        <p>
          By examining the chapters that contribute to each topic, we can assess
          the accuracy and relevance of the topics generated by the LDA model.
          Here, we provide an overview of the significant chapters contributing
          to each topic, along with their corresponding content from the novel.
        </p>
        <div class="visualization">
          <h4>Chapter Contributions</h4>
          <pre><code>python
# Code to display chapter contributions
for topic_id in range(optimal_model.num_topics):
    print(f"Topic {topic_id}:")
    for chapter_id, probability in enumerate(topic_distributions):
        if probability[topic_id] > 0.01:  # Filter for significant contributions
            print(f"Chapter {chapter_id+1}: Probability = {probability[topic_id]:.4f}")
            # Add chapter summary for context
            print(f"Summary: {chapter_summaries[chapter_id]}")
            print()
            </code></pre>
        </div>
      </section>

      <section id="highlighted-text-passages">
        <h2>Highlighted Text Passages</h2>
        <p>
          One of the interactive features we have included is the ability to
          highlight text passages based on topic probabilities. This feature
          allows users to see which words contribute to each topic within
          selected passages.
        </p>
        <div class="highlighted-text" id="passage-1">
          <h4>Passage 1</h4>
          <div class="slider-container">
            <input
              type="range"
              id="passage-1-slider"
              min="1"
              max="100"
              value="1"
              step="1"
            />
          </div>
          <p id="passage-1-text"></p>
        </div>
        <div class="highlighted-text" id="passage-2">
          <h4>Passage 2</h4>
          <div class="slider-container">
            <input
              type="range"
              id="passage-2-slider"
              min="1"
              max="100"
              value="1"
              step="1"
            />
          </div>
          <p id="passage-2-text"></p>
        </div>
        <div class="highlighted-text" id="passage-3">
          <h4>Passage 3</h4>
          <div class="slider-container">
            <input
              type="range"
              id="passage-3-slider"
              min="1"
              max="100"
              value="1"
              step="1"
            />
          </div>
          <p id="passage-3-text"></p>
        </div>
      </section>

      <section id="conclusion">
        <h2>Conclusion</h2>
        <p>
          Through this interactive exploration, we've demonstrated how topic
          modeling can uncover the thematic structure of <em>Jane Eyre</em>. The
          LDA model has generated topics that align well with the narrative
          content, providing insights into the emotional and thematic shifts
          throughout the novel.
        </p>
        <p>
          By examining the chapters that contribute to each topic, we can see
          how accurately the model reflects the novel's themes. This analysis
          highlights the power of topic modeling as a tool for literary analysis
          and offers a new way to explore and understand classic literature.
        </p>
        <p>
          We hope this explorable explanation has been informative and engaging,
          giving you a deeper appreciation of both topic modeling and
          <em>Jane Eyre</em>. Feel free to delve into the visualizations and
          explore the themes on your own!
        </p>
      </section>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
      // Load the interactive visualizations (pyLDAvis, Plotly, etc.) and any other necessary JavaScript here
      $(document).ready(function () {
        // Add code to update the highlighted text based on the slider and topic dropdown
      });
    </script>
  </body>
</html>
